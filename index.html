<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RNG.AI</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #000000; display: flex; flex-direction: column; min-height: 100vh; }

        /* Layout */
        .site-header { position: sticky; top: 0; z-index: 50; background: #000000; border-bottom: 1px solid #151515; padding: 10px 16px; }
        .header-inner { max-width: 1280px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; gap: 12px; }
        .header-left { display: flex; align-items: center; gap: 10px; }
        .header-right { display: flex; align-items: center; gap: 10px; }
        .auth-btn { background: transparent; color: #e5e7eb; border: 1px solid #2d2d2d; border-radius: 8px; padding: 8px 12px; cursor: pointer; transition: background 150ms ease; }
        .auth-btn:hover { background: #111827; }

        .app { width: 100%; max-width: 1280px; margin: 12px auto; display: flex; gap: 12px; align-items: stretch; flex: 1; min-height: 0; }
        .sidebar { width: 280px; background: #000000; border: 1px solid #111827; border-radius: 10px; padding: 16px; color: #cbd5e1; display: flex; flex-direction: column; gap: 12px; animation: slideInLeft 400ms ease-out both; }
        .sidebar-header { display: flex; align-items: center; gap: 10px; }
        .logo-img { width: 28px; height: 28px; object-fit: contain; filter: drop-shadow(0 0 6px rgba(99,102,241,0.4)); transition: transform 300ms ease; }
        .logo-img:hover { transform: rotate(8deg) scale(1.05); }
        .brand1 {
            font-size: 2.5rem;
            font-weight: 200;
            text-transform: uppercase;
            text-align: center;
            background: linear-gradient(90deg, #ff6b6b, #feca57, #1dd1a1, #54a0ff, #5f27cd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
        }
        .history-title { font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.08em; color: #94a3b8; margin-top: 4px; }
        .search-box { display: flex; gap: 8px; }
        .search-input { flex: 1; padding: 0.9rem 1rem; border: 1px solid #334155; border-radius: 10px; background: #0b1220; color: #e5e7eb; outline: none; }
        .search-input::placeholder { color: #64748b; }
        .search-btn { padding: 0.9rem 1rem; background: #03d62a; color: #040404; border: 1px solid #1f3f8a; border-radius: 10px; cursor: pointer; }
        .search-btn:hover { background: #1d4ed8; }
        .history-list { list-style: none; display: flex; flex-direction: column; gap: 6px; overflow-y: auto; max-height: 60vh; padding-right: 4px; }
        .history-item { background: #111827; border: 1px solid #1f2937; border-radius: 8px; padding: 10px; cursor: pointer; color: #e5e7eb; transition: background 200ms ease, transform 120ms ease; animation: fadeIn 300ms ease both; }
        .history-item:hover { background: #1f2937; transform: translateY(-1px); }
        .history-empty { color: #9ca3af; font-size: 0.9rem; padding: 8px 2px; }
        .history-actions { display: flex; gap: 8px; margin-top: 4px; }
        .clear-btn { background: transparent; color: #94a3b8; border: 1px solid #334155; border-radius: 6px; padding: 6px 10px; cursor: pointer; }
        .clear-btn:hover { background: #0b1220; }

        .container { flex: 1; max-width: 100%; background: rgb(0, 0, 0); padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; flex-direction: column; min-height: calc(100vh - 76px - 24px); }
        h1 { text-align: center; margin-bottom: 1rem; color: #e5e7eb; }
        .chat-container { flex: 1; overflow-y: auto; border: 1px solid #000000; border-radius: 8px; padding: 1rem; background: #f6fafa; margin-bottom: 1rem; display: flex; flex-direction: column; gap: 0.5rem; }
        .message { padding: 0.8rem; border-radius: 8px; max-width: 85%; animation: fadeIn 220ms ease-out both; white-space: pre-wrap; }
        .user-message {  color: rgb(2, 61, 19); align-self: flex-end; margin-left: auto; }
        .ai-message { background: #f3f4f6; color: #000000; align-self: flex-start; margin-right: auto; position: relative; }
        .ai-message.alt-bg { background: #e0f2fe; }
        .code-message { padding: 0; background: transparent; }
        .input-container { display: flex; gap: 0.5rem; }
        input { flex: 1; padding: 0.8rem; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 0.8rem 1rem; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .loading { text-align: center; display: none; color: #ec7d0e; margin-bottom: 0.5rem; }

        /* NEW: tool buttons under the search bar */
        .tool-buttons { margin-top: 0.5rem; display: flex; gap: 0.5rem; }
        .tool-btn { flex: 1; padding: 0.8rem 1rem; background: #1f2937; color: #ffffff; border: 1px solid #2d2d2d; border-radius: 6px; cursor: pointer; }
        .tool-btn:hover { background: #374151; }

        /* Editor-style container */
        .code-editor-container { border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; background: #ffffff; }
        .code-editor-header { background: #f3f4f6; color: #111827; padding: 0.5rem 0.75rem; font-size: 0.85rem; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; gap: 0.5rem; justify-content: space-between; }
        .code-header-left { display: flex; align-items: center; gap: 0.5rem; }
        .code-header-right { display: flex; align-items: center; gap: 6px; }
        .code-editor-body { max-height: 360px; }
        .cm-s-neo.CodeMirror { height: 360px; }
        .cm-s-darcula.CodeMirror { height: 360px; }

        /* AI section formatting */
        .ai-section { margin-bottom: 10px; }
        .ai-section-title { font-weight: 700; color: #000000; margin-bottom: 6px; }
        .ai-p { color: #000000; margin: 0 0 8px 0; line-height: 1.45; }
        .ai-list { margin: 0 0 8px 20px; color: #000000; }

        /* Message toolbar */
        .message-toolbar { position: absolute; top: 8px; right: 8px; display: flex; gap: 6px; }
        .icon-btn { border: 1px solid #d1d5db; background: #ffffff; color: #111827; font-size: 12px; padding: 4px 6px; border-radius: 6px; cursor: pointer; display: inline-flex; align-items: center; gap: 4px; }
        .icon-btn:hover { background: #f3f4f6; }
        .icon-btn svg { width: 14px; height: 14px; display: block; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInLeft { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
    </style>
    <!-- CodeMirror 5 CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/neo.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/darcula.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"></script>
</head>
<body>
    <header class="site-header">
        <div class="header-inner">
            <div class="header-left">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSeI5mGEaJdwKOi0KUsyChbuCfd-HLYy0gUdQ&s" alt="RNG.AI logo" class="logo-img">
                <div class="brand1">RNG.AI</div>
            </div>
            <div class="header-right">
                <button class="auth-btn" onclick="openWorkspace()">Project Workspace</button>
            <button class="auth-btn" onclick="openCodeExplain()">Code Explanation</button>
            </div>
        </div>
    </header>

    <div class="app">
        <aside class="sidebar">
            <div class="sidebar-header brand">Search</div>
            <div class="search-box">
                <input id="userInput" class="search-input" type="text" placeholder="Search or ask anything...">
                <button class="search-btn" onclick="sendMessage()">Go</button>
            </div>
            <div class="history-title">Search history</div>
            <ul id="historyList" class="history-list"></ul>
            <div class="history-empty" id="historyEmpty" style="display:none;">No searches yet</div>
            <div class="history-actions">
                <button class="clear-btn" onclick="clearHistory()">Clear</button>
            </div>
        </aside>

    <div class="container">
          
        <div class="chat-container" id="chatContainer"></div>
        <div class="loading" id="loading">AI is thinking...</div>


    </div>

    <script>
        function sendMessage() {
            // your existing send logic
        }

        // NEW: navigation handlers
        function openWorkspace() {
            window.open('workspace.html', '_blank');
        }

        function openCodeExplain() {
            window.open('explain.html', '_blank');
        }
    </script>

    <script>
        const chatContainer = document.getElementById("chatContainer");
        const userInput = document.getElementById("userInput");
        const loadingDiv = document.getElementById("loading");
        const historyList = document.getElementById("historyList");
        const historyEmpty = document.getElementById("historyEmpty");
        const HISTORY_KEY = "rng_ai_search_history";

        function loadHistory() {
            try {
                const raw = localStorage.getItem(HISTORY_KEY);
                return raw ? JSON.parse(raw) : [];
            } catch (_) { return []; }
        }

        function saveHistory(items) {
            try { localStorage.setItem(HISTORY_KEY, JSON.stringify(items)); } catch (_) {}
        }

        function renderHistory() {
            const items = loadHistory();
            historyList.innerHTML = "";
            if (!items.length) {
                historyEmpty.style.display = "block";
                return;
            }
            historyEmpty.style.display = "none";
            items.slice().reverse().forEach((item) => {
                const li = document.createElement("li");
                li.className = "history-item";
                li.title = item.text;
                li.textContent = item.text.length > 60 ? item.text.slice(0, 60) + "…" : item.text;
                li.addEventListener("click", () => {
                    userInput.value = item.text;
                    userInput.focus();
                });
                historyList.appendChild(li);
            });
        }

        function addToHistory(text) {
            const trimmed = text.trim();
            if (!trimmed) return;
            const items = loadHistory();
            const withoutDuplicate = items.filter(i => i.text !== trimmed);
            withoutDuplicate.push({ text: trimmed, ts: Date.now() });
            saveHistory(withoutDuplicate.slice(-100));
            renderHistory();
        }

        function clearHistory() {
            saveHistory([]);
            renderHistory();
        }

        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement("div");
            messageDiv.className = `message ${isUser ? "user-message" : "ai-message"}`;
            messageDiv.textContent = content;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function addAIHtmlMessage(htmlContent) {
            const messageDiv = document.createElement("div");
            messageDiv.className = "message ai-message";

            const toolbar = document.createElement("div");
            toolbar.className = "message-toolbar";

            const toolbarInner = document.createElement("div");
            toolbarInner.className = "message-toolbar-inner";

            const copyBtn = document.createElement("button");
            copyBtn.className = "icon-btn";
            copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg><span>Copy</span>';
            copyBtn.addEventListener('click', () => {
                const tmp = document.createElement('div');
                tmp.innerHTML = htmlContent;
                const text = tmp.textContent || tmp.innerText || "";
                navigator.clipboard.writeText(text);
            });

            const colorBtn = document.createElement("button");
            colorBtn.className = "icon-btn";
            colorBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg><span>Theme</span>';
            colorBtn.addEventListener('click', () => {
                messageDiv.classList.toggle('alt-bg');
            });

            toolbarInner.appendChild(copyBtn);
            toolbarInner.appendChild(colorBtn);
            toolbar.appendChild(toolbarInner);

            const contentDiv = document.createElement("div");
            contentDiv.innerHTML = htmlContent;

            messageDiv.appendChild(toolbar);
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;

            addMessage(message, true);
            userInput.value = "";
            loadingDiv.style.display = "block";
            addToHistory(message);

            try {
                const response = await fetch(
                    "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyDDK0MZUKXK7CHIwQTdzF_m84sIrOhqZko",
                    {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            contents: [
                                {
                                    role: "user",
                                    parts: [{ text: message }]
                                }
                            ]
                        })
                    }
                );
                if (!response.ok) {
                    throw new Error(`Request failed with status ${response.status}`);
                }
                const data = await response.json();
                const candidate = data && data.candidates && data.candidates[0];
                const parts = candidate && candidate.content && candidate.content.parts;
                const aiResponse = Array.isArray(parts) ? parts.map(p => (p && p.text) ? p.text : "").join("") : "Sorry, I couldn't understand the response.";
                renderAIResponse(aiResponse || "");
            } catch (error) {
                addMessage("Error: Unable to process request.");
                console.error("Error:", error);
            } finally {
                loadingDiv.style.display = "none";
            }
        }

        userInput.addEventListener("keypress", function(e) {
            if (e.key === "Enter") sendMessage();
        });

        // Initial render of history on load
        renderHistory();

        function onSignIn() {
            alert('Sign in clicked');
        }

        function onSignUp() {
            alert('Sign up clicked');
        }

        function createLanguageLabel(language) {
            const label = document.createElement("span");
            label.textContent = language ? language.toLowerCase() : "code";
            return label;
        }

        function languageToMode(language) {
            if (!language) return "javascript";
            const lang = language.toLowerCase();
            if (lang.includes("html") || lang === "xml") return "xml";
            if (lang.includes("css")) return "css";
            if (lang.includes("js") || lang.includes("javascript") || lang.includes("ts")) return "javascript";
            if (lang.includes("python") || lang === "py") return "python";
            return "javascript";
        }

        function addCodeEditor(codeText, language) {
            const wrapper = document.createElement("div");
            wrapper.className = "message ai-message code-message";

            const editorContainer = document.createElement("div");
            editorContainer.className = "code-editor-container";

            const header = document.createElement("div");
            header.className = "code-editor-header";

            const left = document.createElement('div');
            left.className = 'code-header-left';
            left.appendChild(createLanguageLabel(language));

            const right = document.createElement('div');
            right.className = 'code-header-right';

            const copyBtn = document.createElement('button');
            copyBtn.className = 'icon-btn';
            copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg><span>Copy</span>';

            const themeBtn = document.createElement('button');
            themeBtn.className = 'icon-btn';
            themeBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg><span>Theme</span>';

            const body = document.createElement("div");
            body.className = "code-editor-body";

            const textarea = document.createElement("textarea");
            textarea.value = codeText;
            body.appendChild(textarea);

            right.appendChild(copyBtn);
            right.appendChild(themeBtn);
            header.appendChild(left);
            header.appendChild(right);
            editorContainer.appendChild(header);
            editorContainer.appendChild(body);
            wrapper.appendChild(editorContainer);
            chatContainer.appendChild(wrapper);

            const cm = CodeMirror.fromTextArea(textarea, {
                mode: languageToMode(language),
                theme: "neo",
                lineNumbers: true,
                lineWrapping: false,
                viewportMargin: Infinity,
                indentUnit: 2,
                tabSize: 2
            });

            copyBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(cm.getValue());
            });

            let dark = false;
            themeBtn.addEventListener('click', () => {
                dark = !dark;
                cm.setOption('theme', dark ? 'darcula' : 'neo');
                wrapper.classList.toggle('alt-bg', dark);
            });

            setTimeout(() => {
                chatContainer.scrollTop = chatContainer.scrollHeight;
                cm.refresh();
            }, 0);
        }

        function renderAIResponse(text) {
            if (!text) {
                addMessage("Sorry, something went wrong.");
                return;
            }

            const codeBlockRegex = /```([\w+-]*)\n([\s\S]*?)```/g;
            let match;
            const codeBlocks = [];
            while ((match = codeBlockRegex.exec(text)) !== null) {
                codeBlocks.push({ language: match[1] || "", code: match[2] || "" });
            }

            if (codeBlocks.length > 0) {
                codeBlocks.forEach(cb => addCodeEditor(cb.code.trim(), cb.language));
            } else {
                const html = structureAsSections(text);
                addAIHtmlMessage(html);
            }
        }

        function structureAsSections(rawText) {
            const withoutCode = rawText.replace(/```[\s\S]*?```/g, "");
            const stripped = withoutCode
                .replace(/\*\*(.*?)\*\*/g, '$1')
                .replace(/\*(.*?)\*/g, '$1')
                .replace(/`([^`]*)`/g, '$1')
                .replace(/^\s*[-*+]\s+/gm, '')
                .replace(/^\s*#{1,6}\s+/gm, '')
                .replace(/^\s*>\s?/gm, '')
                .replace(/\s*\/\/.*$/gm, '')
                .trim();

            const lines = stripped
                .split(/\r?\n/)
                .map(l => l.trim())
                .filter(Boolean);

            // Heuristics: first 2-3 lines as paragraph; collect key points prefixed with common markers; detect advantages/disadvantages; rest as conclusion.
            const keyPointMarkers = [/^\d+\./, /^-\s*/, /^\*\s*/, /^•\s*/];
            const isKeyPoint = (l) => keyPointMarkers.some(r => r.test(l));
            const normalized = lines.map(l => l.replace(/^\d+\.\s*/, '').replace(/^[-*•]\s*/, ''));

            const paragraphLines = [];
            const keyPoints = [];
            const advantages = [];
            const disadvantages = [];
            const rest = [];

            let section = 'para';
            normalized.forEach((l) => {
                const lower = l.toLowerCase();
                if (/(advantage|pros)\b/.test(lower)) { section = 'pros'; return; }
                if (/(disadvantage|cons)\b/.test(lower)) { section = 'cons'; return; }

                if (section === 'para' && !isKeyPoint(l) && paragraphLines.join(' ').length < 400) {
                    paragraphLines.push(l);
                    return;
                }
                if (isKeyPoint(l)) { keyPoints.push(l.replace(/^\d+\.\s*/, '')); return; }
                if (section === 'pros') { advantages.push(l); return; }
                if (section === 'cons') { disadvantages.push(l); return; }
                rest.push(l);
            });

            const conclusion = rest.slice(-2).join(' ');

            const esc = (s) => s
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');

            const renderList = (items) => items.length ? `<ul class="ai-list">${items.map(i => `<li>${esc(i)}</li>`).join('')}</ul>` : '';

            const htmlSections = [];
            if (paragraphLines.length) {
                htmlSections.push(`<div class="ai-section"><div class="ai-section-title">Paragraph</div><p class="ai-p">${esc(paragraphLines.join(' '))}</p></div>`);
            }
            if (keyPoints.length) {
                htmlSections.push(`<div class="ai-section"><div class="ai-section-title">Key Points</div>${renderList(keyPoints)}</div>`);
            }
            if (advantages.length) {
                htmlSections.push(`<div class="ai-section"><div class="ai-section-title">Advantages</div>${renderList(advantages)}</div>`);
            }
            if (disadvantages.length) {
                htmlSections.push(`<div class="ai-section"><div class="ai-section-title">Disadvantages</div>${renderList(disadvantages)}</div>`);
            }
            if (conclusion) {
                htmlSections.push(`<div class="ai-section"><div class="ai-section-title">Conclusion</div><p class="ai-p">${esc(conclusion)}</p></div>`);
            }

            // Fallback if everything empty
            if (!htmlSections.length) {
                return `<p class="ai-p">${esc(stripped)}</p>`;
            }
            return htmlSections.join('');
        }
    </script>
</body>
</html>
